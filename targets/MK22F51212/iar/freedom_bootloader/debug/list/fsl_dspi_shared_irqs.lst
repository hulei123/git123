###############################################################################
#
# IAR ANSI C/C++ Compiler V7.50.3.10732/W32 for ARM       13/Mar/2016  16:46:55
# Copyright 1999-2016 IAR Systems AB.
#
#    Cpu mode     =  thumb
#    Endian       =  little
#    Source file  =  
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\src\drivers\dspi\src\fsl_dspi_shared_irqs.c
#    Command line =  
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\src\drivers\dspi\src\fsl_dspi_shared_irqs.c
#        -D NDEBUG -D CPU_MK22FN512VDC12 -D CPU_IS_ARM_CORTEX_M4=1 -D IAR -D
#        FREEDOM -D BL_TARGET_FLASH -lC
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader\debug\list
#        --diag_suppress Pa050 -o
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader\debug\obj
#        --no_unroll --debug --endian=little --cpu=Cortex-M4 -e --fpu=None
#        --dlib_config "F:\Program Files\IAR Systems\Embedded Workbench
#        7.3\arm\INC\c\DLib_Config_Normal.h" -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../src\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/include\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/include/device\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/autobaud\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/drivers\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/startup\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/drivers/uart\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/hid_device\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/adapter/sources\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/adapter/sources/bm\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/os/bm\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/platform/arch/cortex_m\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/platform/soc/MK22F\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/platform/bsp/mk22f\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/device/include\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/device/include/mk22f\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/device/sources\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/device/sources/bsp/mk22f\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/device/sources/classes/common\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/device/sources/classes/hid\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/device/sources/classes/include\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/device/sources/controller\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/device/sources/controller/khci\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/device/sources/controller/ehci\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/hal\
#        -I
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader/../../../../src/usb_stack/usb_core/include\
#        -Ohz --use_c++_inline
#    List file    =  
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader\debug\list\fsl_dspi_shared_irqs.lst
#    Object file  =  
#        C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\targets\MK22F51212\iar\freedom_bootloader\debug\obj\fsl_dspi_shared_irqs.o
#
###############################################################################

C:\Users\hulei\Desktop\FSL_Kinetis_Bootloader_1_2_1\src\drivers\dspi\src\fsl_dspi_shared_irqs.c
      1          /*
      2           * Copyright (c) 2013, Freescale Semiconductor, Inc.
      3           * All rights reserved.
      4           *
      5           * Redistribution and use in source and binary forms, with or without modification,
      6           * are permitted provided that the following conditions are met:
      7           *
      8           * o Redistributions of source code must retain the above copyright notice, this list
      9           *   of conditions and the following disclaimer.
     10           *
     11           * o Redistributions in binary form must reproduce the above copyright notice, this
     12           *   list of conditions and the following disclaimer in the documentation and/or
     13           *   other materials provided with the distribution.
     14           *
     15           * o Neither the name of Freescale Semiconductor, Inc. nor the names of its
     16           *   contributors may be used to endorse or promote products derived from this
     17           *   software without specific prior written permission.
     18           *
     19           * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
     20           * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
     21           * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
     22           * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
     23           * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
     24           * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
     25           * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
     26           * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
     27           * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
     28           * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
     29           */
     30          
     31          #include "fsl_dspi_shared_irqs.h"
     32          #include "bootloader_common.h"
     33          
     34          #if BL_CONFIG_DSPI
     35          
     36          /*******************************************************************************
     37           * Variables
     38           ******************************************************************************/
     39          
     40          /*!
     41           * @brief Declare instantiations of the shared irq configuration. This is used in the irq handler 
     42           * to keep track of the driver type (master or slave) and the driver run-time state. 
     43           */

   \                                 In section .bss, align 4
     44          dspi_shared_irq_config_t g_dspiSharedIrqConfig[SPI_INSTANCE_COUNT];
   \                     g_dspiSharedIrqConfig:
   \   00000000                      DS8 16
     45          
     46          /*!
     47           * @brief Table to save DSPI IRQ enum numbers defined in CMSIS files. 
     48           *
     49           * This is used by DSPI master and slave init functions to enable or disable DSPI interrupts. 
     50           * This table is indexed by the module instance number and returns DSPI IRQ numbers.
     51           */
     52          /*
     53          #if defined (MK64F12_SERIES) || defined (MK70F12_SERIES)   
     54          IRQn_Type dspi_irq_ids[SPI_INSTANCE_COUNT] = {SPI0_IRQn, SPI1_IRQn, SPI2_IRQn};
     55          #elif defined (MK22F51212_SERIES)
     56          IRQn_Type dspi_irq_ids[SPI_INSTANCE_COUNT] = {SPI0_IRQn, SPI1_IRQn};
     57          #endif
     58          */
     59          /*******************************************************************************
     60           * Prototypes
     61           ******************************************************************************/
     62          
     63          static void dspi_handle_shared_irq(uint32_t instance);
     64          
     65          /*******************************************************************************
     66           * Code
     67           ******************************************************************************/
     68          
     69          /*! 
     70           * @brief The function dspi_handle_shared_irq passes IRQ control to either the master or 
     71           * slave driver.
     72           *
     73           * The address of the IRQ handlers are checked to make sure they are non-zero before
     74           * they are called. If the IRQ handler's address is zero, it means that driver was
     75           * not present in the link (because the IRQ handlers are marked as weak). This would
     76           * actually be a program error, because it means the master/slave config for the IRQ
     77           * was set incorrectly.
     78           */

   \                                 In section .text, align 2, keep-with-next
     79          static void dspi_handle_shared_irq(uint32_t instance)
     80          {
   \                     dspi_handle_shared_irq: (+1)
   \   00000000   0xB580             PUSH     {R7,LR}
     81              if (g_dspiSharedIrqConfig[instance].isMaster)
   \   00000002   0x....             LDR.N    R1,??DataTable0
   \   00000004   0xEB01 0x02C0      ADD      R2,R1,R0, LSL #+3
   \   00000008   0xF811 0x0030      LDRB     R0,[R1, R0, LSL #+3]
   \   0000000C   0xB128             CBZ.N    R0,??dspi_handle_shared_irq_0
     82              {
     83                  /* Master mode.*/
     84                  if (&dspi_master_irq_handler)
   \   0000000E   0x....             LDR.N    R0,??DataTable0_1
   \   00000010   0xB140             CBZ.N    R0,??dspi_handle_shared_irq_1
     85                  {
     86                      dspi_master_irq_handler(g_dspiSharedIrqConfig[instance].state);
   \   00000012   0x6850             LDR      R0,[R2, #+4]
   \   00000014   0x.... 0x....      BL       dspi_master_irq_handler
   \   00000018   0xBD01             POP      {R0,PC}
     87                  }
     88              }
     89              else
     90              {
     91                  /* Slave mode.*/
     92                  if (&dspi_slave_irq_handler)
   \                     ??dspi_handle_shared_irq_0: (+1)
   \   0000001A   0x....             LDR.N    R0,??DataTable0_2
   \   0000001C   0xB110             CBZ.N    R0,??dspi_handle_shared_irq_1
     93                  {
     94                      dspi_slave_irq_handler(g_dspiSharedIrqConfig[instance].state);
   \   0000001E   0x6850             LDR      R0,[R2, #+4]
   \   00000020   0x.... 0x....      BL       dspi_slave_irq_handler
     95                  }
     96              }
     97          }
   \                     ??dspi_handle_shared_irq_1: (+1)
   \   00000024   0xBD01             POP      {R0,PC}          ;; return
     98          
     99          /*! 
    100           * @brief This function is the implementation of SPI0 handler named in startup code. 
    101           * 
    102           * It passes the instance to the shared DSPI IRQ handler.
    103           */

   \                                 In section .text, align 2, keep-with-next
    104          void SPI0_IRQHandler(void)
    105          {
    106              dspi_handle_shared_irq(SPI0_IDX);
   \                     SPI0_IRQHandler: (+1)
   \   00000000   0x2000             MOVS     R0,#+0
   \   00000002   0x....             B.N      dspi_handle_shared_irq
    107          }
    108          
    109          #if (SPI_INSTANCE_COUNT > 1U)
    110          /*! 
    111           * @brief This function is the implementation of SPI1 handler named in startup code. 
    112           * 
    113           * It passes the instance to the shared DSPI IRQ handler.
    114           */

   \                                 In section .text, align 2, keep-with-next
    115          void SPI1_IRQHandler(void)
    116          {
    117              dspi_handle_shared_irq(SPI1_IDX);
   \                     SPI1_IRQHandler: (+1)
   \   00000000   0x2001             MOVS     R0,#+1
   \   00000002   0x....             B.N      dspi_handle_shared_irq
    118          }

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable0:
   \   00000000   0x........         DC32     g_dspiSharedIrqConfig

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable0_1:
   \   00000000   0x........         DC32     dspi_master_irq_handler

   \                                 In section .text, align 4, keep-with-next
   \                     ??DataTable0_2:
   \   00000000   0x........         DC32     dspi_slave_irq_handler
    119          #endif  //(SPI_INSTANCE_COUNT > 1U)
    120          
    121          #if (SPI_INSTANCE_COUNT > 2U)
    122          /*! 
    123           * @brief This function is the implementation of SPI2 handler named in startup code. 
    124           * 
    125           * It passes the instance to the shared DSPI IRQ handler.
    126           */
    127          void SPI2_IRQHandler(void)
    128          {
    129              dspi_handle_shared_irq(SPI2_IDX);
    130          }
    131          #endif  //(SPI_INSTANCE_COUNT > 2U)
    132          
    133          #endif // BL_CONFIG_DSPI
    134          
    135          /*******************************************************************************
    136           * EOF
    137           ******************************************************************************/
    138          

   Maximum stack usage in bytes:

   .cstack Function
   ------- --------
       0   SPI0_IRQHandler
         0   -> dspi_handle_shared_irq
       0   SPI1_IRQHandler
         0   -> dspi_handle_shared_irq
       8   dspi_handle_shared_irq
         8   -> dspi_master_irq_handler
         8   -> dspi_slave_irq_handler


   Section sizes:

   Bytes  Function/Label
   -----  --------------
       4  ??DataTable0
       4  ??DataTable0_1
       4  ??DataTable0_2
       4  SPI0_IRQHandler
       4  SPI1_IRQHandler
      38  dspi_handle_shared_irq
      16  g_dspiSharedIrqConfig

 
 16 bytes in section .bss
 58 bytes in section .text
 
 58 bytes of CODE memory
 16 bytes of DATA memory

Errors: none
Warnings: none
